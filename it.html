<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Catastrofi Mondiali</title>
<link rel="icon" href="favicon.ico" type="image/x-icon">
<style>
body { font-family:Arial; margin:0; padding:0; background:black; color:white;}
header { background: rgba(0,0,0,0.7); padding:10px 15px; text-align:center; }
.container { max-width:900px; margin:20px auto; background: rgba(0,0,0,0.8); padding:20px; border-radius:10px;}
.item { padding:15px; border-bottom:1px solid #444; margin-bottom:10px; border-radius:5px; background: rgba(255,255,255,0.05);}
.item:last-child { border-bottom:none; }
.small { font-size:0.9em; color:#ccc; }
#loading-screen { position:fixed; top:0; left:0; width:100%; height:100%; display:flex; justify-content:center; align-items:center; background:black; z-index:9999;}
.loader { border:8px solid rgba(255,255,255,0.3); border-top:8px solid #fff; border-radius:50%; width:50px; height:50px; animation: spin 2s linear infinite;}
@keyframes spin {0% {transform:rotate(0deg);}100% {transform:rotate(360deg);}}
</style>
</head>
<body>

<div id="loading-screen"><div class="loader"></div></div>

<header>
    <h1>Catastrofi Mondiali</h1>
</header>

<h2 style="text-align:center;">Meteo Locale</h2>
<div class="container" id="weatherContainer">Caricamento meteo...</div>

<h2 style="text-align:center;">Catastrofi e Eventi</h2>
<div class="container" id="eventsContainer">Caricamento eventi...</div>

<script>
// --- Météo locale ---
async function fetchWeather() {
    const container = document.getElementById('weatherContainer');
    container.innerHTML = 'Caricamento meteo...';

    if (!navigator.geolocation) {
        container.innerHTML = "Geolocalizzazione non supportata.";
        return;
    }

    navigator.geolocation.getCurrentPosition(async pos => {
        const lat = pos.coords.latitude;
        const lon = pos.coords.longitude;
        try {
            const res = await fetch(`https://wttr.in/${lat},${lon}?format=j1`);
            const data = await res.json();
            const current = data.current_condition[0];
            container.innerHTML = `<div class="item">
                <strong>Posizione</strong>: ${lat.toFixed(2)}, ${lon.toFixed(2)}<br>
                Condizioni: ${current.weatherDesc[0].value}<br>
                Temperatura: ${current.temp_C}°C<br>
                Umidità: ${current.humidity}%<br>
                Vento: ${current.windspeedKmph} km/h
            </div>`;
        } catch {
            container.innerHTML = "Impossibile ottenere la meteo locale";
        }
    }, () => {
        container.innerHTML = "Autorizzazione geolocalizzazione rifiutata.";
    });
}

// --- Catastrophes ---
async function fetchEvents() {
    const container = document.getElementById('eventsContainer');
    container.innerHTML = 'Caricamento eventi...';
    try {
        const res = await fetch('https://eonet.gsfc.nasa.gov/api/v3/events');
        const data = await res.json();
        container.innerHTML = '';
        data.events.forEach(event => {
            const eventTime = new Date(event.geometry[0]?.date || Date.now());
            const minutesAgo = Math.floor((Date.now() - eventTime)/60000);
            const lat = event.geometry[0]?.coordinates[1] || 0;
            const lon = event.geometry[0]?.coordinates[0] || 0;
            const div = document.createElement('div');
            div.className = 'item';
            div.innerHTML = `<strong>${event.title}</strong><br>
            Categoria: ${event.categories.map(c=>c.title).join(', ')}<br>
            Localizzazione: ${lat.toFixed(2)}, ${lon.toFixed(2)}<br>
            Data: ${eventTime.toLocaleString()}<br>
            <span class="small">Circa ${minutesAgo} minuti fa</span>`;
            container.appendChild(div);
        });
        document.getElementById('loading-screen').style.display = 'none';
    } catch {
        container.innerHTML = 'Impossibile caricare gli eventi';
        document.getElementById('loading-screen').style.display = 'none';
    }
}

fetchWeather();
fetchEvents();
setInterval(()=>{fetchWeather(); fetchEvents();},60000);
</script>

</body>
</html>
